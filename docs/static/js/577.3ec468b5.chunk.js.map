{"version":3,"file":"static/js/577.3ec468b5.chunk.js","mappings":"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","sources":["../webpack/runtime/chunk loaded","../webpack/runtime/startup chunk dependencies","clientDatabase/client.db.ts","clientDatabase/recipeIndex.worker.ts","../webpack/bootstrap","../webpack/runtime/compat get default export","../webpack/runtime/define property getters","../webpack/runtime/ensure chunk","../webpack/runtime/get javascript chunk filename","../webpack/runtime/get mini-css chunk filename","../webpack/runtime/global","../webpack/runtime/hasOwnProperty shorthand","../webpack/runtime/publicPath","../webpack/runtime/importScripts chunk loading","../webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn __webpack_require__.e(771).then(next);\n};","import { DBSchema, IDBPTransaction, openDB } from 'idb';\n\nimport { HitpointsEntityType, HitpointsEvent, Recipe, RecipeTag, ShoppingList } from '@hitpoints/shared';\n\nexport interface RecipeSearchIndex {\n    order: string[];\n    tags: {\n        [key in RecipeTag]?: string[];\n    };\n    text: string;\n    idMap: Map<string, string>;\n}\n\nexport interface AssortedMap {\n    eventSyncCursor: string;\n    shoppingList: ShoppingList;\n    recipeSearchIndexCursor: Date;\n    recipeSearchIndex: RecipeSearchIndex;\n    pinnedRecipes: string[];\n}\n\nexport interface StoredEvents {\n    id: string;\n    type: HitpointsEntityType;\n    events: Map<string, HitpointsEvent>;\n    syncing: Map<string, Date>;\n    unsynced?: 1;\n}\n\nexport interface ClientDB extends DBSchema  {\n    assorted: {\n        key: string;\n        value: unknown;\n    };\n    recipes: {\n        key: string;\n        value: Recipe;\n        indexes: {\n            pinned: number;\n        }\n    };\n    events: {\n        key: string;\n        value: StoredEvents;\n        indexes: {\n            unsynced: number;\n        };\n    }\n}\n\nconst databaseVersion = 1;\n\nconst clientDB = openDB<ClientDB>('hitpoints', databaseVersion, {\n    upgrade(db) {\n        db.createObjectStore('assorted');\n\n        const events = db.createObjectStore('events', {\n            keyPath: 'id',\n        });\n        events.createIndex('unsynced', 'unsynced');\n\n        db.createObjectStore('recipes', {\n            keyPath: 'id',\n        });\n    },\n});\n\nexport function getDatabase() {\n    return clientDB;\n}\n\nexport const keyVal = {\n    async get<Key extends keyof AssortedMap, Value extends AssortedMap[Key]>(\n        key: Key,\n        transaction?: IDBPTransaction<ClientDB, ['assorted'], 'readonly' | 'readwrite'>,\n    ) {\n        if (transaction) {\n            return transaction.objectStore('assorted').get(key) as Promise<Value | undefined>;\n        }\n\n        const db = await getDatabase();\n\n        return db.get('assorted', key) as Promise<Value | undefined>;\n    },\n    async set<Key extends keyof AssortedMap, Value extends AssortedMap[Key]>(\n        key: Key,\n        value: Value,\n        transaction?: IDBPTransaction<ClientDB, ['assorted'], 'readwrite'>,\n    ) {\n        if (transaction) {\n            await transaction.objectStore('assorted').put(value, key);\n        }\n\n        const db = await getDatabase();\n        await db.put('assorted', value, key);\n    },\n};\n","import lunr from 'lunr';\n\nimport { Recipe, RecipeTag } from '@hitpoints/shared';\n\nimport { getDatabase, keyVal } from './client.db';\n\nonmessage = () => {\n    // TODO debounce\n    createIndex();\n};\n\nfunction createDefaultOrder(recipes: Recipe[]) {\n    const compare = new Intl.Collator('en', { ignorePunctuation: true }).compare;\n    const order = [...recipes].sort((a, b) => compare(a.name, b.name))\n        .map(recipe => recipe.id);\n\n    return order;\n}\n\nfunction createTagsIndex(recipes: Recipe[]) {\n    const tags: {\n        [key in RecipeTag]?: string[];\n    } = {};\n\n    recipes.forEach(recipe => {\n        recipe.tags.forEach(tag => {\n            if (!tags[tag]) {\n                tags[tag] = [];\n            }\n\n            tags[tag]?.push(recipe.id);\n        });\n    });\n\n    return tags;\n}\n\nfunction createTextIndex(recipes: Recipe[]) {\n    const index = lunr(builder => {\n        builder.field('name');\n        builder.field('ingredients');\n\n        recipes.forEach(recipe => {\n            const ingredients = recipe.ingredients\n                .map(ingredient => ingredient.type === 'Ingredient' && ingredient.name)\n                .join(' ');\n\n            builder.add({\n                id: recipe.id,\n                name: recipe.name,\n                ingredients,\n            });\n        });\n    });\n\n    return JSON.stringify(index);\n}\n\nasync function createIndex() {\n    const start = new Date();\n\n    const db = await getDatabase();\n    const allRecipes = await db.getAll('recipes');\n\n    const recipes = allRecipes.filter(recipe => !recipe.deleted);\n\n    const idMap = new Map<string, string>();\n    recipes.forEach((recipe, i) => {\n        const shortId = i.toString();\n\n        idMap.set(shortId, recipe.id);\n        recipe.id = shortId;\n    });\n\n    const index = {\n        order: createDefaultOrder(recipes),\n        tags: createTagsIndex(recipes),\n        text: createTextIndex(recipes),\n        idMap,\n    };\n\n    const transaction = db.transaction('assorted', 'readwrite');\n\n    const cursor = await keyVal.get('recipeSearchIndexCursor', transaction);\n    if (cursor && start < cursor) {\n        // Something else has changed the index with a later timestamp\n        await transaction.done;\n        return;\n    }\n\n    await Promise.all([\n        keyVal.set('recipeSearchIndex', index, transaction),\n        keyVal.set('recipeSearchIndexCursor', start, transaction),\n    ]);\n\n    await transaction.done;\n\n    new BroadcastChannel('recipeIndex').postMessage(index);\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [771], () => (__webpack_require__(577)))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"static/js/\" + chunkId + \".\" + \"4ad965c5\" + \".chunk.js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl + \"../../\";","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t577: 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = globalThis[\"webpackChunk_hitpoints_client\"] = globalThis[\"webpackChunk_hitpoints_client\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["deferred","next","clientDB","openDB","upgrade","db","createObjectStore","keyPath","createIndex","getDatabase","keyVal","async","key","transaction","objectStore","get","value","put","createDefaultOrder","recipes","compare","Intl","Collator","ignorePunctuation","sort","a","b","name","map","recipe","id","createTagsIndex","tags","forEach","tag","push","createTextIndex","index","lunr","builder","field","ingredients","ingredient","type","join","add","JSON","stringify","onmessage","start","Date","getAll","filter","deleted","idMap","Map","i","shortId","toString","set","order","text","cursor","done","Promise","all","BroadcastChannel","postMessage","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","x","__webpack_exports__","O","result","chunkIds","fn","priority","notFulfilled","Infinity","length","fulfilled","j","Object","keys","every","splice","r","n","getter","__esModule","d","definition","o","defineProperty","enumerable","f","e","chunkId","reduce","promises","u","miniCssF","g","globalThis","this","Function","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","Error","replace","p","installedChunks","chunkLoadingGlobal","parentChunkLoadingFunction","bind","data","moreModules","runtime","pop","then"],"sourceRoot":""}